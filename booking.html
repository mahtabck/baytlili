<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Book Bayt Lili</title>
  <meta name="description" content="Book Bayt Lili for filming, photoshoots, or stays. Submit your request or message us on WhatsApp.">
  <link rel="icon" type="image/png" href="assets/favicon.png"/>

  <style>
    :root{
      --text:#fff; --muted:#eaeaea;
      --line: rgba(255,255,255,.30);
      --card: rgba(255,255,255,.10);
      --btn:#ffffff; --btnText:#1f1f1f;
      --price-bg:#fff; --price-text:#1b1b1b; --price-border:rgba(0,0,0,.08);
      --control-h: 44px; /* unified control height */
    }
    @font-face{
      font-family:'BaytLili';
      src: url('assets/BaytLili.ttf') format('truetype'),
           url('assets/BaytLili.otf') format('opentype');
      font-display:swap;
    }
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--text);
      font-family:'Playfair Display', serif; line-height:1.5;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      background:#000;
    }
    body::before{
      content:""; position:fixed; inset:0;
      background:url('assets/lightbg.png') center 35%/cover no-repeat fixed; z-index:-2;
    }
    body::after{
      content:""; position:fixed; inset:0;
      background:rgba(0,0,0,.28); z-index:-1;
    }

    /* Header/nav (same as index) */
    header{
      position:sticky; top:0; z-index:50;
      background:rgba(0,0,0,0.18);
      backdrop-filter:blur(10px);
      border-bottom:1px solid rgba(255,255,255,0.2);
    }
    .nav{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:12px 0}
    .brand{
      display:flex;align-items:center;gap:10px;color:#fff;
      font-family:'BaytLili','Playfair Display',serif;
      letter-spacing:.12em;font-variant:small-caps;white-space:nowrap;
      text-decoration:none;
      text-shadow:0 2px 6px rgba(0,0,0,.35);
    }
    .brand img{height:34px}
    .menu{display:flex;align-items:center;gap:20px}
    .menu a{
      color:#fff;text-decoration:none;white-space:nowrap;
      text-shadow:0 2px 6px rgba(0,0,0,.35);
      font-size:1rem; position:relative; padding:6px 2px;
    }
    .menu a::after{
      content:""; position:absolute; left:0; right:0; bottom:-4px; height:1px;
      background:transparent; transition:background .2s ease;
    }
    .menu a:hover::after{background:rgba(255,255,255,.7)}

    .container{width:min(900px,92vw); margin:0 auto; padding:clamp(24px,5vw,48px) 0}

    h1{
      font-family:'BaytLili','Playfair Display',serif;
      margin:18px 0 8px; font-size:clamp(26px,4.4vw,40px);
      text-shadow:0 3px 10px rgba(0,0,0,.35);
    }
    p.lede{color:var(--muted); margin:0 0 18px}

    .card{
      background:var(--card); border:1px solid var(--line);
      border-radius:16px; padding:18px; backdrop-filter:blur(4px);
    }

    /* Form grid */
    form{display:grid; grid-template-columns:1fr 1fr; gap:14px}
    .full{grid-column:1 / -1}
    label{font-size:.95rem; opacity:.95}

    /* Controls — unified look/height */
    input, select, textarea{
      width:100%; padding:12px 12px; margin-top:6px;
      border-radius:10px; border:1px solid var(--line);
      background:rgba(255,255,255,.92); color:#111; font-size:16px;
      font-family:'Playfair Display', serif;
      height:var(--control-h);
    }
    textarea{min-height:120px; height:auto; resize:vertical}

    /* Make native date input match select height */
    input[type="date"]{
      -webkit-appearance:none; appearance:none;
      line-height:calc(var(--control-h) - 2px);
      padding-top:0; padding-bottom:0;
    }
    /* Normalize select height on some browsers */
    select{ line-height:calc(var(--control-h) - 2px); }

    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .radio{
      display:inline-flex; gap:8px; align-items:center;
      padding:10px 12px; border:1px solid var(--line); border-radius:999px;
      background:rgba(255,255,255,.10); user-select:none;
      height:var(--control-h);
    }
    .radio input{accent-color:#fff; width:18px; height:18px}

    /* Filming day rows */
    .day{
      display:grid; grid-template-columns: 1.2fr .9fr .9fr auto; gap:10px; align-items:end;
      margin-top:6px;
    }
    .day button.rem{
      background:transparent; color:#fff; border:1px solid var(--line); border-radius:10px; padding:.65em .8em; cursor:pointer;
      font-family:'Playfair Display', serif;
      height:var(--control-h);
    }

    .add-more{margin-top:6px}
    .add-more button{
      background:#fff; color:#111; border:1px solid rgba(0,0,0,.08);
      border-radius:999px; padding:.6em 1em; cursor:pointer; font-weight:600;
      font-family:'Playfair Display', serif;
      height:var(--control-h);
    }

    .price-card{
      grid-column:1/-1;
      background:var(--price-bg); color:var(--price-text);
      border:1px solid var(--price-border); border-radius:14px;
      padding:14px 16px; margin-top:6px;
      box-shadow:0 6px 24px rgba(0,0,0,.12);
    }
    .price-card small{color:#555}

    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:.5em;
      padding:.75em 1.1em; border-radius:999px; border:1px solid rgba(0,0,0,.08);
      background:#fff; color:#111; font-weight:600; letter-spacing:.02em;
      cursor:pointer; text-decoration:none;
      font-family:'Playfair Display', serif; /* same font for <a> and <button> */
      height:var(--control-h);
    }
    .btn.secondary{background:transparent; color:#fff; border:1px solid var(--line)}
    .btn:hover{opacity:.92}

    #form-status{margin-top:8px;font-size:.95rem}

    /* New: place Purpose radios to the RIGHT of Phone on the same row */
    .purpose-cell{
      display:flex; justify-content:flex-end; align-items:center; gap:10px;
    }
  </style>
</head>
<body>

  <!-- Header / Nav -->
  <header>
    <div class="container nav">
      <a class="brand" href="index.html" aria-label="Bayt Lili — Home">
        <img src="assets/bllogo.png" alt="Bayt Lili"/> BAYT LILI
      </a>
      <nav class="menu" aria-label="Primary">
        <a href="index.html#gallery">Gallery</a>
        <a href="rates.html">Rates</a>
        <a href="booking.html">Booking</a>
        <a href="index.html#contact">Contact</a>
      </nav>
    </div>
  </header>

  <div class="container">
    <h1>Booking Request</h1>
    <p class="lede">Tell us about your booking. We reply the same day.</p>

    <div class="card">
      <!-- One form only -->
      <form id="booking-form">
        <div>
          <label for="name">Full name *</label>
          <input id="name" name="name" type="text" required placeholder="Your name"/>
        </div>

        <div>
          <label for="email">Email *</label>
          <input id="email" name="email" type="email" required placeholder="name@email.com"/>
        </div>

        <!-- Phone on the LEFT... -->
        <div>
          <label for="phone">Phone (with country code) *</label>
          <input id="phone" name="phone" type="tel" required placeholder="+9715XXXXXXXX"/>
        </div>

        <!-- ...Purpose on the RIGHT, same row -->
        <div class="purpose-cell">
          <div class="row" role="radiogroup" aria-label="Purpose">
            <label class="radio"><input type="radio" name="purpose" value="Filming"> Filming / Shoot</label>
            <label class="radio"><input type="radio" name="purpose" value="Stay"> Stay</label>
          </div>
        </div>

        <!-- FILMING SECTION -->
        <div id="filmFields" class="full" style="display:none">
          <div class="full">
            <label for="company">Company / Brand (required for shoots)</label>
            <input id="company" name="company" type="text" placeholder="Company or brand"/>
          </div>

          <!-- Days list -->
          <div id="daysWrap" class="full"></div>

          <div class="add-more">
            <button type="button" id="addDayBtn">+ Add another day</button>
          </div>

          <!-- PRICE CARD -->
          <div id="priceCard" class="price-card" style="display:none">
            <div id="priceSummary" style="font-weight:700">Estimated Total: AED 0</div>
            <small id="priceNotes">Rate: AED 350/hr. Minimum: 6 hours (AED 2100) per day. Refundable deposit: AED 5000.</small>
          </div>
        </div>

        <!-- STAY SECTION -->
        <div id="stayFields" class="full" style="display:none">
          <p class="lede">For stays, please book on Airbnb or message us on WhatsApp.</p>
        </div>

        <!-- ACTION BUTTONS -->
        <div class="actions full" id="filmButtons" style="display:none">
          <button type="submit" class="btn" id="request-booking">Request Booking</button>
          <a class="btn secondary" id="whatsappDirect" href="#" target="_blank" rel="noopener">WhatsApp Us</a>
        </div>

        <div class="actions full" id="stayButtons" style="display:none">
          <a class="btn secondary" id="whatsappStay" href="#" target="_blank" rel="noopener">WhatsApp Us</a>
          <a class="btn" id="airbnbBtn" href="https://www.airbnb.com/rooms/1010972686934184319" target="_blank" rel="noopener">View on Airbnb</a>
        </div>

        <p id="form-status" role="status"></p>
      </form>
    </div>

    <footer style="margin-top:24px; color:#dcdcdc; font-size:.95rem">
      Prefer Instagram? DM us at <a href="https://instagram.com/baytlili" target="_blank" rel="noopener">@baytlili</a>.
    </footer>
  </div>

  <script>
    // ---------- Config ----------
    const WHATSAPP_NUMBER = '971501589628';
    const SHEETS_ENDPOINT = 'https://script.google.com/macros/s/AKfycbzP17hb9riNcRnWQ06dinxrqwII6CYjH247SV6xCnhd9bJV6nVBVANkVRA0QZA70OII/exec';
    const RATE_PER_HOUR = 350;      // change to 300 if needed
    const MIN_HOURS_PER_DAY = 6;
    const DAY_MIN_CHARGE = RATE_PER_HOUR * MIN_HOURS_PER_DAY;

    // ---------- Elements ----------
    const form = document.getElementById('booking-form');
    const statusEl = document.getElementById('form-status');
    const filmFields = document.getElementById('filmFields');
    const stayFields = document.getElementById('stayFields');
    const filmButtons = document.getElementById('filmButtons');
    const stayButtons = document.getElementById('stayButtons');
    const daysWrap = document.getElementById('daysWrap');
    const addDayBtn = document.getElementById('addDayBtn');
    const priceCard = document.getElementById('priceCard');
    const priceSummary = document.getElementById('priceSummary');

    // Purpose change (radios always selectable)
    form.addEventListener('change', (e) => {
      if (e.target.name === 'purpose') {
        if (e.target.value === 'Filming') {
          stayFields.style.display = 'none';
          stayButtons.style.display = 'none';
          filmFields.style.display = '';
          filmButtons.style.display = '';
          priceCard.style.display = '';
          ensureAtLeastOneDay();
          updatePrice();
        } else {
          filmFields.style.display = 'none';
          filmButtons.style.display = 'none';
          priceCard.style.display = 'none';
          stayFields.style.display = '';
          stayButtons.style.display = '';
        }
      }
    });

    // ---------- Time options (15-min increments via <select>) ----------
    function buildTimeOptions(){
      const opts = ['<option value="" disabled selected>Select time</option>'];
      for (let m=0; m<24*60; m+=15){
        const hh = String(Math.floor(m/60)).padStart(2,'0');
        const mm = String(m%60).padStart(2,'0');
        const label = `${hh}:${mm}`;
        opts.push(`<option value="${label}">${label}</option>`);
      }
      return opts.join('');
    }
    const TIME_OPTIONS_HTML = buildTimeOptions();

    // Day rows with selects
    function makeDayRow(){
      const row = document.createElement('div');
      row.className = 'day';
      row.innerHTML = `
        <label>Date
          <input type="date" name="day_date" required>
        </label>
        <label>From
          <select name="day_from" required>${TIME_OPTIONS_HTML}</select>
        </label>
        <label>To
          <select name="day_to" required>${TIME_OPTIONS_HTML}</select>
        </label>
        <button type="button" class="rem" aria-label="Remove day">Remove</button>
      `;
      row.querySelector('.rem').addEventListener('click', () => {
        row.remove();
        updatePrice();
        if (daysWrap.children.length === 0) ensureAtLeastOneDay();
      });
      row.querySelector('[name=day_from]').addEventListener('change', updatePrice);
      row.querySelector('[name=day_to]').addEventListener('change', updatePrice);
      row.querySelector('[name=day_date]').addEventListener('change', updatePrice);
      return row;
    }

    function ensureAtLeastOneDay(){
      if(daysWrap.children.length === 0){
        daysWrap.appendChild(makeDayRow());
      }
    }

    if(addDayBtn){
      addDayBtn.addEventListener('click', () => {
        daysWrap.appendChild(makeDayRow());
        updatePrice();
      });
    }

    // Price calculation
    function parseTime(t){ if(!t) return null; const [h,m]=t.split(':').map(Number); return h*60+(m||0); }
    function computeHours(from,to){ const a=parseTime(from), b=parseTime(to); if(a==null||b==null) return 0; let diff=(b-a)/60; if(diff<0) diff+=24; return Math.max(0,diff); }

    function updatePrice(){
      const purpose = (new FormData(form)).get('purpose');
      if(purpose !== 'Filming'){ priceCard.style.display='none'; return; }
      priceCard.style.display='';
      let totalHours = 0, totalPrice = 0;

      [...daysWrap.children].forEach(row => {
        const from = row.querySelector('[name=day_from]').value;
        const to = row.querySelector('[name=day_to]').value;
        const hrs = computeHours(from, to);
        const billable = Math.max(hrs, MIN_HOURS_PER_DAY);
        totalHours += hrs;
        totalPrice += billable * RATE_PER_HOUR;
      });

      priceSummary.textContent = `Estimated Total: AED ${isFinite(totalPrice)?Math.round(totalPrice):0} — Total Selected Hours: ${isFinite(totalHours)?totalHours.toFixed(2):'0'}`;
      document.getElementById('priceNotes').textContent = `Rate: AED ${RATE_PER_HOUR}/hr. Minimum: ${MIN_HOURS_PER_DAY} hours (AED ${DAY_MIN_CHARGE}) per day. Refundable deposit: AED 5000.`;
    }

    // WhatsApp buttons
    function openWA(msg){
      window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg||'Hello Bayt Lili')}`,'_blank');
    }
    document.getElementById('whatsappDirect').addEventListener('click', (e)=>{ e.preventDefault(); openWA('Hello Bayt Lili — I’d like to inquire about filming availability.'); });
    document.getElementById('whatsappStay').addEventListener('click',   (e)=>{ e.preventDefault(); openWA('Hello Bayt Lili — I’m interested in a stay.'); });

    // Build concise summary for the message we log in the sheet
    function buildMessageFilming(){
      const fd = new FormData(form);
      const name = fd.get('name')||'-';
      const email = fd.get('email')||'-';
      const phone = fd.get('phone')||'-';
      const company = fd.get('company')||'-';

      let total = 0, dayLines=[];
      [...daysWrap.children].forEach((row,i)=>{
        const date = row.querySelector('[name=day_date]').value || '-';
        const from = row.querySelector('[name=day_from]').value || '-';
        const to   = row.querySelector('[name=day_to]').value || '-';
        const hrs  = computeHours(from,to);
        const bill = Math.max(hrs, MIN_HOURS_PER_DAY);
        const price = bill * RATE_PER_HOUR;
        total += price;
        dayLines.push(`Day ${i+1}: ${date} — ${from}-${to} (hrs ${hrs.toFixed(2)}, billable ${bill.toFixed(2)}, AED ${Math.round(price)})`);
      });

      return [
        'Booking Request — Filming',
        `Name: ${name}`, `Company: ${company}`, `Email: ${email}`, `Phone: ${phone}`,
        '', ...dayLines, '',
        `Estimated Total: AED ${Math.round(total)} (rate AED ${RATE_PER_HOUR}/hr; ${MIN_HOURS_PER_DAY}h min/day)`
      ].join('\n');
    }

    // Submit (all fields must be filled)
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const fd = new FormData(form);
      const name    = (fd.get('name')||'').trim();
      const email   = (fd.get('email')||'').trim();
      const phone   = (fd.get('phone')||'').trim();
      const purpose = fd.get('purpose');

      if (!name || !email || !phone) {
        statusEl.textContent = 'Please fill in Name, Email, and Phone.';
        statusEl.style.color = 'crimson';
        return;
      }
      if (!purpose) {
        statusEl.textContent = 'Please choose Filming or Stay.';
        statusEl.style.color = 'crimson';
        return;
      }

      let messageToLog = 'Booking Request — Stay';
      if (purpose === 'Filming') {
        const company = (fd.get('company')||'').trim();
        if (!company) {
          statusEl.textContent = 'Please enter your Company / Brand for shoots.';
          statusEl.style.color = 'crimson';
          return;
        }
        if (daysWrap.children.length === 0) {
          statusEl.textContent = 'Please add at least one day.';
          statusEl.style.color = 'crimson';
          return;
        }
        for (const row of daysWrap.children) {
          const from = row.querySelector('[name=day_from]').value;
          const to   = row.querySelector('[name=day_to]').value;
          const date = row.querySelector('[name=day_date]').value;
          if (!date || !from || !to) {
            statusEl.textContent = 'Please complete date and time for each day.';
            statusEl.style.color = 'crimson';
            return;
          }
          const hrs = computeHours(from,to);
          if (hrs < MIN_HOURS_PER_DAY) {
            statusEl.textContent = 'Each shoot day must be at least 6 hours.';
            statusEl.style.color = 'crimson';
            return;
          }
        }
        messageToLog = buildMessageFilming();
      }

      const params = new URLSearchParams();
      params.set('name', name);
      params.set('email', email);
      params.set('phone', phone);
      params.set('inquiry', purpose === 'Filming' ? 'Filming / Shoot' : 'Stay');
      params.set('message', messageToLog);
      params.set('pageUrl', window.location.href);
      params.set('userAgent', navigator.userAgent);

      const submitBtn = document.getElementById('request-booking');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Sending…';
      statusEl.textContent = '';

      try {
        await fetch(SHEETS_ENDPOINT, {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' },
          body: params.toString()
        });

        form.reset();
        // Reset sections
        filmFields.style.display = 'none';
        filmButtons.style.display = 'none';
        priceCard.style.display = 'none';
        stayFields.style.display = 'none';
        stayButtons.style.display = 'none';

        statusEl.textContent = 'Thank you! Your request has been received. We’ll get back to you shortly.';
        statusEl.style.color = 'limegreen';
      } catch (err) {
        statusEl.textContent = 'Network error. Please try again.';
        statusEl.style.color = 'crimson';
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Request Booking';
      }
    });

    // Seed a first day when Filming is chosen initially
    function ensureAtLeastOneDay(){
      if(daysWrap.children.length === 0){
        daysWrap.appendChild(makeDayRow());
      }
    }
  </script>
</body>
</html>
