<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Book Bayt Lili</title>
  <meta name="description" content="Book Bayt Lili for filming, photoshoots, or stays. Submit your request or message us on WhatsApp.">
  <link rel="icon" type="image/png" href="assets/favicon.png"/>
  <style>
    :root{--text:#fff;--muted:#eaeaea;--line:rgba(255,255,255,.30);--card:rgba(255,255,255,.10);--btn:#ffffff;--btnText:#1f1f1f;--price-bg:#fff;--price-text:#1b1b1b;--price-border:rgba(0,0,0,.08)}
    @font-face{font-family:'BaytLili';src:url('assets/BaytLili.ttf') format('truetype'),url('assets/BaytLili.otf') format('opentype');font-display:swap}
    *,*::before,*::after{box-sizing:border-box} html,body{height:100%}
    body{margin:0;color:var(--text);font-family:'Playfair Display',serif;line-height:1.5;background:#000;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    body::before{content:"";position:fixed;inset:0;background:url('assets/lightbg.png') center 35%/cover no-repeat fixed;z-index:-2}
    body::after{content:"";position:fixed;inset:0;background:rgba(0,0,0,.28);z-index:-1}
    .container{width:min(900px,92vw);margin:0 auto;padding:clamp(24px,5vw,48px) 0}
    header .top{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:center;gap:10px;font-family:'BaytLili','Playfair Display',serif;letter-spacing:.12em;font-variant:small-caps;color:#fff;text-decoration:none}
    .brand img{height:34px} a{color:#fff;text-decoration:none}.back{opacity:.9}.back:hover{opacity:1;text-decoration:underline}
    h1{font-family:'BaytLili','Playfair Display',serif;margin:18px 0 8px;font-size:clamp(26px,4.4vw,40px);text-shadow:0 3px 10px rgba(0,0,0,.35)}
    p.lede{color:var(--muted);margin:0 0 18px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px;backdrop-filter:blur(4px)}
    form{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .full{grid-column:1/-1}
    label{font-size:.95rem;opacity:.95}
    input,select,textarea{width:100%;padding:12px 12px;margin-top:6px;border-radius:10px;border:1px solid var(--line);background:rgba(255,255,255,.92);color:#111;font-size:16px}
    textarea{min-height:120px;resize:vertical}
    .row{display:flex;gap:10px;align-items:center}
    .radio{display:inline-flex;gap:8px;align-items:center;padding:10px 12px;border:1px solid var(--line);border-radius:999px;background:rgba(255,255,255,.10);cursor:pointer;user-select:none}
    .radio input{accent-color:#fff;width:18px;height:18px}
    .day{display:grid;grid-template-columns:1.2fr .9fr .9fr auto;gap:10px;align-items:end;margin-top:6px}
    .day button.rem{background:transparent;color:#fff;border:1px solid var(--line);border-radius:10px;padding:.65em .8em;cursor:pointer}
    .add-more{margin-top:6px}
    .add-more button{background:#fff;color:#111;border:1px solid rgba(0,0,0,.08);border-radius:999px;padding:.6em 1em;cursor:pointer;font-weight:600}
    .price-card{grid-column:1/-1;background:var(--price-bg);color:var(--price-text);border:1px solid var(--price-border);border-radius:14px;padding:14px 16px;margin-top:6px;box-shadow:0 6px 24px rgba(0,0,0,.12)}
    .price-card small{color:#555}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:.5em;padding:.75em 1.1em;border-radius:999px;border:1px solid rgba(0,0,0,.08);background:#fff;color:#111;font-weight:600;letter-spacing:.02em;cursor:pointer;text-decoration:none}
    .btn.secondary{background:transparent;color:#fff;border:1px solid var(--line)}
    .btn:hover{opacity:.92}
    #form-status{margin-top:8px;font-size:.95rem}
  </style>
</head>
<body>
  <div class="container">
    <header class="top">
      <a class="back" href="index.html" aria-label="Back to home">← Back</a>
      <a class="brand" href="index.html" aria-label="Bayt Lili — Home">
        <img src="assets/bllogo.png" alt="Bayt Lili"/> BAYT LILI
      </a>
    </header>

    <h1>Booking Request</h1>
    <p class="lede">Tell us about your booking. We reply the same day.</p>

    <div class="card">
      <!-- ✅ This is the ONLY form, with the IDs your script uses -->
      <form id="booking-form">
        <div>
          <label for="name">Full name *</label>
          <input id="name" name="name" type="text" required placeholder="Your name"/>
        </div>

        <div>
          <label for="email">Email *</label>
          <input id="email" name="email" type="email" required placeholder="name@email.com"/>
        </div>

        <div>
          <label for="phone">Phone (with country code)</label>
          <input id="phone" name="phone" type="tel" placeholder="+9715XXXXXXXX"/>
        </div>

        <div class="full">
          <div class="row" role="radiogroup" aria-label="Purpose">
            <label class="radio"><input type="radio" name="purpose" value="Filming" id="purpose-filming" disabled> Filming / Shoot</label>
            <label class="radio"><input type="radio" name="purpose" value="Stay" id="purpose-stay" disabled> Stay</label>
          </div>
          <small style="opacity:.9">Fill in your Name & Email to choose.</small>
        </div>

        <!-- FILMING SECTION -->
        <div id="filmFields" class="full" style="display:none">
          <div class="full">
            <label for="company">Company / Brand (required for shoots)</label>
            <input id="company" name="company" type="text" placeholder="Company or brand"/>
          </div>

          <div id="daysWrap" class="full"></div>
          <div class="add-more"><button type="button" id="addDayBtn">+ Add another day</button></div>

          <div id="priceCard" class="price-card" style="display:none">
            <div id="priceSummary" style="font-weight:700">Estimated Total: AED 0</div>
            <small id="priceNotes">Rate: AED 350/hr. Minimum: 6 hours (AED 2100) per day. Refundable deposit: AED 5000.</small>
          </div>
        </div>

        <!-- STAY SECTION -->
        <div id="stayFields" class="full" style="display:none">
          <p class="lede">For stays, please book on Airbnb or message us on WhatsApp.</p>
        </div>

        <!-- ACTION BUTTONS -->
        <div class="actions full" id="filmButtons" style="display:none">
          <button type="submit" class="btn" id="request-booking">Request Booking</button>
          <a class="btn secondary" id="whatsappDirect" href="#" target="_blank" rel="noopener">WhatsApp Us</a>
        </div>

        <div class="actions full" id="stayButtons" style="display:none">
          <a class="btn secondary" id="whatsappStay" href="#" target="_blank" rel="noopener">WhatsApp Us</a>
          <a class="btn" id="airbnbBtn" href="https://www.airbnb.com/rooms/1010972686934184319" target="_blank" rel="noopener">View on Airbnb</a>
        </div>

        <p id="form-status" role="status"></p>
      </form>
    </div>

    <footer>Prefer Instagram? DM us at <a href="https://instagram.com/baytlili" target="_blank" rel="noopener">@baytlili</a>.</footer>
  </div>

  <script>
    // ---------- Config ----------
    const WHATSAPP_NUMBER = '971501589628';
    const SHEETS_ENDPOINT = 'https://script.google.com/macros/s/AKfycbzP17hb9riNcRnWQ06dinxrqwII6CYjH247SV6xCnhd9bJV6nVBVANkVRA0QZA70OII/exec';
    const RATE_PER_HOUR = 350;       // change to 300 if needed
    const MIN_HOURS_PER_DAY = 6;
    const DAY_MIN_CHARGE = RATE_PER_HOUR * MIN_HOURS_PER_DAY; // 2100 at 350/hr

    // ---------- Elements ----------
    const form = document.getElementById('booking-form');
    const statusEl = document.getElementById('form-status');
    const filmFields = document.getElementById('filmFields');
    const stayFields = document.getElementById('stayFields');
    const filmButtons = document.getElementById('filmButtons');
    const stayButtons = document.getElementById('stayButtons');
    const daysWrap = document.getElementById('daysWrap');
    const addDayBtn = document.getElementById('addDayBtn');
    const priceCard = document.getElementById('priceCard');
    const priceSummary = document.getElementById('priceSummary');
    const purposeFilming = document.getElementById('purpose-filming');
    const purposeStay = document.getElementById('purpose-stay');

    // Enable purpose choices only after name+email
    function togglePurposeEnabled() {
      const nameOk = document.getElementById('name').value.trim().length > 0;
      const emailOk = document.getElementById('email').value.trim().length > 0;
      const enable = nameOk && emailOk;
      purposeFilming.disabled = !enable;
      purposeStay.disabled = !enable;
    }
    document.getElementById('name').addEventListener('input', togglePurposeEnabled);
    document.getElementById('email').addEventListener('input', togglePurposeEnabled);
    togglePurposeEnabled();

    // Purpose change
    form.addEventListener('change', (e) => {
      if (e.target.name === 'purpose') {
        if (e.target.value === 'Filming') {
          stayFields.style.display = 'none';
          stayButtons.style.display = 'none';
          filmFields.style.display = '';
          filmButtons.style.display = '';
          priceCard.style.display = '';
          ensureAtLeastOneDay();
          updatePrice();
        } else {
          filmFields.style.display = 'none';
          filmButtons.style.display = 'none';
          priceCard.style.display = 'none';
          stayFields.style.display = '';
          stayButtons.style.display = '';
        }
      }
    });

    // Day rows
    function makeDayRow(){
      const row = document.createElement('div');
      row.className = 'day';
      row.innerHTML = `
        <label>Date
          <input type="date" name="day_date" required>
        </label>
        <label>From
          <input type="time" name="day_from" required step="900">
        </label>
        <label>To
          <input type="time" name="day_to" required step="900">
        </label>
        <button type="button" class="rem" aria-label="Remove day">Remove</button>
      `;
      row.querySelector('.rem').addEventListener('click', () => {
        row.remove();
        updatePrice();
        if (daysWrap.children.length === 0) ensureAtLeastOneDay();
      });
      ['day_date','day_from','day_to'].forEach(n=>{
        row.querySelector(`[name=${n}]`).addEventListener('change', updatePrice);
        row.querySelector(`[name=${n}]`).addEventListener('input', updatePrice);
      });
      return row;
    }
    function ensureAtLeastOneDay(){ if (daysWrap.children.length === 0) daysWrap.appendChild(makeDayRow()); }
    if (addDayBtn) addDayBtn.addEventListener('click', () => { daysWrap.appendChild(makeDayRow()); updatePrice(); });

    function parseTime(t){ if(!t) return null; const [h,m]=t.split(':').map(Number); return h*60+(m||0); }
    function computeHours(from,to){ const a=parseTime(from), b=parseTime(to); if(a==null||b==null) return 0; let d=(b-a)/60; if(d<0)d+=24; return Math.max(0,d); }

    function updatePrice(){
      const purpose = (new FormData(form)).get('purpose');
      if (purpose !== 'Filming') { priceCard.style.display='none'; return; }
      priceCard.style.display='';
      let totalHours = 0, totalPrice = 0;
      [...daysWrap.children].forEach(row=>{
        const from=row.querySelector('[name=day_from]').value;
        const to=row.querySelector('[name=day_to]').value;
        const hrs=computeHours(from,to);
        const billable=Math.max(hrs, MIN_HOURS_PER_DAY);
        totalHours += hrs;
        totalPrice += billable * RATE_PER_HOUR;
      });
      priceSummary.textContent = `Estimated Total: AED ${isFinite(totalPrice)?Math.round(totalPrice):0} — Total Selected Hours: ${isFinite(totalHours)?totalHours.toFixed(2):'0'}`;
      document.getElementById('priceNotes').textContent = `Rate: AED ${RATE_PER_HOUR}/hr. Minimum: ${MIN_HOURS_PER_DAY} hours (AED ${DAY_MIN_CHARGE}) per day. Refundable deposit: AED 5000.`;
    }

    // WhatsApp buttons
    function openWA(msg){ window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg||'Hello Bayt Lili')}`,'_blank'); }
    document.getElementById('whatsappDirect').addEventListener('click', (e)=>{ e.preventDefault(); openWA('Hello Bayt Lili — I’d like to inquire about filming availability.'); });
    document.getElementById('whatsappStay').addEventListener('click', (e)=>{ e.preventDefault(); openWA('Hello Bayt Lili — I’m interested in a stay.'); });

    // Build a concise message for logs/WA (not used for submission)
    function buildMessageFilming(){
      const fd = new FormData(form);
      const name = fd.get('name')||'-', email=fd.get('email')||'-', phone=fd.get('phone')||'-', company=(fd.get('company')||'-');
      let total = 0, dayLines=[];
      [...daysWrap.children].forEach((row,i)=>{
        const date=row.querySelector('[name=day_date]').value||'-';
        const from=row.querySelector('[name=day_from]').value||'-';
        const to=row.querySelector('[name=day_to]').value||'-';
        const hrs=computeHours(from,to), billHrs=Math.max(hrs,MIN_HOURS_PER_DAY), price=billHrs*RATE_PER_HOUR;
        total+=price; dayLines.push(`Day ${i+1}: ${date} — ${from}-${to} (hrs ${hrs.toFixed(2)}, billable ${billHrs.toFixed(2)}, AED ${Math.round(price)})`);
      });
      return ['Booking Request — Filming',`Name: ${name}`,`Company: ${company}`,`Email: ${email}`,`Phone: ${phone}`,'',...dayLines,'',`Estimated Total: AED ${Math.round(total)} (rate AED ${RATE_PER_HOUR}/hr; ${MIN_HOURS_PER_DAY}h min/day)`].join('\n');
    }

    // ---------- SUBMIT to Google Sheets (silent) ----------
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('name');
      const email = document.getElementById('email');
      const purpose = (new FormData(form)).get('purpose');

      // Required validations
      if (!name.value.trim() || !email.value.trim()) {
        statusEl.textContent = 'Please fill in Name and Email to continue.'; statusEl.style.color = 'crimson'; name.focus(); return;
      }
      if (!purpose) { statusEl.textContent = 'Please choose Filming or Stay.'; statusEl.style.color = 'crimson'; return; }

      // If Filming, require company and at least one 6h day
      if (purpose === 'Filming') {
        const company = document.getElementById('company').value.trim();
        if (!company) { statusEl.textContent = 'Please enter your Company / Brand for shoots.'; statusEl.style.color = 'crimson'; return; }
        if (daysWrap.children.length === 0) { statusEl.textContent = 'Please add at least one day.'; statusEl.style.color = 'crimson'; return; }
        for (const row of daysWrap.children) {
          const hrs = computeHours(row.querySelector('[name=day_from]').value, row.querySelector('[name=day_to]').value);
          if (hrs < MIN_HOURS_PER_DAY) { statusEl.textContent = 'Each shoot day must be at least 6 hours.'; statusEl.style.color = 'crimson'; return; }
        }
      }

      // Build payload for Sheets
      const params = new URLSearchParams();
      params.set('name', name.value.trim());
      params.set('email', email.value.trim());
      params.set('phone', (document.getElementById('phone').value || '').trim());
      params.set('inquiry', purpose === 'Filming' ? 'Filming / Shoot' : 'Stay');
      params.set('message', purpose === 'Filming' ? buildMessageFilming() : 'Booking Request — Stay');
      params.set('pageUrl', window.location.href);
      params.set('userAgent', navigator.userAgent);

      const submitBtn = document.getElementById('request-booking');
      submitBtn.disabled = true; submitBtn.textContent = 'Sending…'; statusEl.textContent = '';

      try {
        await fetch(SHEETS_ENDPOINT, {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' },
          body: params.toString()
        });
        form.reset();
        togglePurposeEnabled();
        filmFields.style.display = 'none';
        filmButtons.style.display = 'none';
        priceCard.style.display = 'none';
        stayFields.style.display = 'none';
        stayButtons.style.display = 'none';
        statusEl.textContent = 'Thank you! Your request has been received. We’ll get back to you shortly.';
        statusEl.style.color = 'limegreen';
      } catch (err) {
        statusEl.textContent = 'Network error. Please try again.'; statusEl.style.color = 'crimson';
      } finally {
        submitBtn.disabled = false; submitBtn.textContent = 'Request Booking';
      }
    });
  </script>
</body>
</html>
